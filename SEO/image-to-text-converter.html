<div class="separator" style="clear: both;"><a href="https://cdn-icons-png.flaticon.com/128/18140/18140616.png" style="display: block; padding: 1em 0px; text-align: center;"><img alt="" border="0" data-original-height="128" data-original-width="128" src="https://cdn-icons-png.flaticon.com/128/18140/18140616.png" style="display: none;" width="200" /></a></div>


<html lang="en">
<head>
    <meta charset="UTF-8"></meta>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"></meta>
    <title>Image to Text Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --error-color: #ea4335;
            --warning-color: #fbbc05;
            --light-bg: #f8f9fa;
            --dark-bg: #202124;
            --light-text: #f8f9fa;
            --dark-text: #202124;
            --border-color: #dadce0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--light-text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .description {
            color: inherit;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .tool-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 992px) {
            .tool-container {
                flex-direction: row;
            }
        }

        .upload-section, .output-section {
            flex: 1;
            background-color: inherit;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .dark-mode .upload-section, 
        .dark-mode .output-section {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .upload-method {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3367d6;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #2d9249;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: inherit;
        }

        .btn-outline:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-mode .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d33426;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-text);
        }

        .btn-warning:hover {
            background-color: #e6ac04;
        }

        .drop-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
            position: relative;
        }

        .drop-area:hover, .drop-area.highlight {
            border-color: var(--primary-color);
            background-color: rgba(66, 133, 244, 0.05);
        }

        .dark-mode .drop-area:hover, 
        .dark-mode .drop-area.highlight {
            background-color: rgba(66, 133, 244, 0.1);
        }

        .drop-area i {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .drop-area p {
            margin-bottom: 10px;
        }

        .drop-area .btn {
            margin-top: 10px;
        }

        #fileInput {
            display: none;
        }

        .image-preview {
            margin-top: 20px;
            text-align: center;
            position: relative;
        }

        #imagePreview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 4px;
            display: none;
        }

        .image-tools {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .ocr-options {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: inherit;
            color: inherit;
        }

        .range-value {
            display: inline-block;
            width: 30px;
            text-align: right;
        }

        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .dark-mode .progress-bar {
            background-color: #3c4043;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 0.8rem;
            color: inherit;
            opacity: 0.8;
        }

        .output-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        #textOutput {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: vertical;
            background-color: inherit;
            color: inherit;
            font-family: inherit;
            line-height: 1.6;
        }

        .text-formatting {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .text-formatting .btn {
            padding: 5px 10px;
            min-width: 30px;
            justify-content: center;
        }

        .confidence-display {
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0.8;
            display: none;
        }

        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            border: none;
        }

        .privacy-notice {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 20px;
            text-align: center;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .dark-mode .privacy-notice {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .batch-files {
            margin-top: 15px;
            display: none;
        }

        .batch-file-list {
            list-style: none;
            margin-top: 10px;
        }

        .batch-file-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .batch-file-item:last-child {
            border-bottom: none;
        }

        .batch-file-actions {
            display: flex;
            gap: 5px;
        }

        .status-message {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }

        .status-success {
            background-color: rgba(52, 168, 83, 0.2);
            border-left: 4px solid var(--secondary-color);
        }

        .status-error {
            background-color: rgba(234, 67, 53, 0.2);
            border-left: 4px solid var(--error-color);
        }

        .status-warning {
            background-color: rgba(251, 188, 5, 0.2);
            border-left: 4px solid var(--warning-color);
        }

        @media (max-width: 768px) {
            .upload-method {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .image-tools, .output-tools, .text-formatting {
                justify-content: center;
            }
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        .dark-mode .spinner {
            border-top-color: var(--dark-text);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Image to Text Converter</h1>
            <p class="description">Extract text from images, photos, and scanned documents with high accuracy. 100% client-side processing - your data never leaves your device.</p>
        </header>

        <div class="tool-container">
            <div class="upload-section">
                <h2 class="section-title"><i>📷</i> Upload Image</h2>
                
                <div class="upload-options">
                    <div class="upload-method">
                        <button class="btn btn-primary" id="uploadBtn">
                            <i>📁</i> Choose File
                        </button>
                        <button class="btn btn-outline" id="pasteBtn">
                            <i>📋</i> Paste Image
                        </button>
                        <button class="btn btn-outline" disabled="" id="cameraBtn" title="Not supported in all browsers">
                            <i>📸</i> Use Camera
                        </button>
                    </div>

                    <div class="drop-area" id="dropArea">
                        <i>⬆️</i>
                        <p>Drag &amp; Drop image here</p>
                        <p class="small">or</p>
                        <button class="btn btn-outline">Select Image</button>
                    </div>

                    <input accept="image/*" id="fileInput" type="file" />

                    <div class="image-preview">
                        <img alt="Preview" id="imagePreview" />
                        <div class="image-tools">
                            <button class="btn btn-outline" disabled="" id="cropBtn">
                                <i>✂️</i> Crop
                            </button>
                            <button class="btn btn-outline" disabled="" id="rotateBtn">
                                <i>🔄</i> Rotate
                            </button>
                            <button class="btn btn-outline" disabled="" id="enhanceBtn">
                                <i>✨</i> Enhance
                            </button>
                            <button class="btn btn-danger" disabled="" id="clearBtn">
                                <i>🗑️</i> Clear
                            </button>
                        </div>
                    </div>

                    <div class="batch-files" id="batchFiles">
                        <h3>Selected Files</h3>
                        <ul class="batch-file-list" id="batchFileList"></ul>
                    </div>

                    <div class="ocr-options">
                        <div class="form-group">
                            <label for="languageSelect">OCR Language:</label>
                            <select id="languageSelect">
                                <option value="eng">English</option>
                                <option value="urd">Urdu</option>
                                <option value="ara">Arabic</option>
                                <option value="chi_sim">Chinese (Simplified)</option>
                                <option value="chi_tra">Chinese (Traditional)</option>
                                <option value="fra">French</option>
                                <option value="deu">German</option>
                                <option value="hin">Hindi</option>
                                <option value="ita">Italian</option>
                                <option value="jpn">Japanese</option>
                                <option value="kor">Korean</option>
                                <option value="por">Portuguese</option>
                                <option value="rus">Russian</option>
                                <option value="spa">Spanish</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="brightnessSlider">Brightness: <span class="range-value" id="brightnessValue">0</span></label>
                            <input disabled="" id="brightnessSlider" max="100" min="-100" type="range" value="0" />
                        </div>

                        <div class="form-group">
                            <label for="contrastSlider">Contrast: <span class="range-value" id="contrastValue">100</span></label>
                            <input disabled="" id="contrastSlider" max="200" min="0" type="range" value="100" />
                        </div>
                    </div>

                    <button class="btn btn-secondary" disabled="" id="extractBtn">
                        <i>🔍</i> <a href="">Extract Text</a>
                    </button>

                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress" id="progressBar"></div>
                        </div>
                        <div class="progress-text" id="progressText">Initializing OCR engine...</div>
                    </div>

                    <div class="status-message" id="statusMessage"></div>
                </div>
            </div>

            <div class="output-section">
                <h2 class="section-title"><i>📝</i> Extracted Text</h2>
                
                <div class="output-tools">
                    <div class="text-formatting">
                        <button class="btn btn-outline" disabled="" id="boldBtn" title="Bold"><b>B</b></button>
                        <button class="btn btn-outline" disabled="" id="italicBtn" title="Italic"><i>I</i></button>
                        <button class="btn btn-outline" disabled="" id="underlineBtn" title="Underline"><u>U</u></button>
                        <select class="btn-outline" disabled="" id="fontFamily">
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                        <select class="btn-outline" disabled="" id="fontSize">
                            <option value="1">Small</option>
                            <option selected="" value="2">Medium</option>
                            <option value="3">Large</option>
                        </select>
                    </div>
                </div>

                <div class="output-tools">
                    <button class="btn btn-outline" disabled="" id="copyBtn">
                        <i>📋</i> <a href="https://essentialmost.com/AbJdyf">Copy Text</a>
                    </button>
                    <button class="btn btn-outline" disabled="" id="downloadTxtBtn">
                        <i>📄</i> <a href="https://essentialmost.com/AbJdyf">Download as TXT</a>
                    </button>
                    <button class="btn btn-outline" disabled="" id="downloadPdfBtn">
                        <i>📑</i> <a href="https://essentialmost.com/AbJdyf">Download as PDF</a>
                    </button>
                    <button class="btn btn-outline" disabled="" id="downloadDocxBtn">
                        <i>📝</i> <a href="https://essentialmost.com/AbJdyf">Download as DOCX</a>
                    </button>
                    <button class="btn btn-danger" disabled="" id="clearTextBtn">
                        <i>🗑️</i> <a href="https://essentialmost.com/AbJdyf">Clear Text</a>
                    </button>
                </div>

                <textarea id="textOutput" placeholder="Extracted text will appear here..." readonly=""></textarea>
                
                <div class="confidence-display" id="confidenceDisplay">
                    OCR Confidence: <span id="confidenceValue">0</span>%
                </div>

                <div class="privacy-notice">
                    <i>🔒</i> Your privacy is protected. All processing happens in your browser. No images or extracted text are sent to any server.
                </div>
            </div>
        </div>
    </div>

    <button class="theme-toggle" id="themeToggle">
        <span id="themeIcon">🌙</span>
    </button>

    <script>
        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const cameraBtn = document.getElementById('cameraBtn');
        const dropArea = document.getElementById('dropArea');
        const imagePreview = document.getElementById('imagePreview');
        const extractBtn = document.getElementById('extractBtn');
        const textOutput = document.getElementById('textOutput');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const clearBtn = document.getElementById('clearBtn');
        const clearTextBtn = document.getElementById('clearTextBtn');
        const copyBtn = document.getElementById('copyBtn');
        const downloadTxtBtn = document.getElementById('downloadTxtBtn');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const downloadDocxBtn = document.getElementById('downloadDocxBtn');
        const languageSelect = document.getElementById('languageSelect');
        const brightnessSlider = document.getElementById('brightnessSlider');
        const contrastSlider = document.getElementById('contrastSlider');
        const brightnessValue = document.getElementById('brightnessValue');
        const contrastValue = document.getElementById('contrastValue');
        const confidenceDisplay = document.getElementById('confidenceDisplay');
        const confidenceValue = document.getElementById('confidenceValue');
        const statusMessage = document.getElementById('statusMessage');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const cropBtn = document.getElementById('cropBtn');
        const rotateBtn = document.getElementById('rotateBtn');
        const enhanceBtn = document.getElementById('enhanceBtn');
        const boldBtn = document.getElementById('boldBtn');
        const italicBtn = document.getElementById('italicBtn');
        const underlineBtn = document.getElementById('underlineBtn');
        const fontFamily = document.getElementById('fontFamily');
        const fontSize = document.getElementById('fontSize');
        const batchFiles = document.getElementById('batchFiles');
        const batchFileList = document.getElementById('batchFileList');

        // State variables
        let currentImage = null;
        let rotationAngle = 0;
        let isProcessing = false;
        let batchFilesArray = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                themeIcon.textContent = '☀️';
            }
        });

        // Event Listeners
        uploadBtn.addEventListener('click', () => fileInput.click());
        pasteBtn.addEventListener('click', handlePaste);
        cameraBtn.addEventListener('click', startCamera);
        fileInput.addEventListener('change', handleFileSelect);
        dropArea.addEventListener('click', () => fileInput.click());
        extractBtn.addEventListener('click', extractText);
        clearBtn.addEventListener('click', clearImage);
        clearTextBtn.addEventListener('click', clearText);
        copyBtn.addEventListener('click', copyText);
        downloadTxtBtn.addEventListener('click', () => downloadText('txt'));
        downloadPdfBtn.addEventListener('click', () => downloadText('pdf'));
        downloadDocxBtn.addEventListener('click', () => downloadText('docx'));
        themeToggle.addEventListener('click', toggleTheme);
        cropBtn.addEventListener('click', startCropping);
        rotateBtn.addEventListener('click', rotateImage);
        enhanceBtn.addEventListener('click', enhanceImage);
        boldBtn.addEventListener('click', () => formatText('bold'));
        italicBtn.addEventListener('click', () => formatText('italic'));
        underlineBtn.addEventListener('click', () => formatText('underline'));
        fontFamily.addEventListener('change', () => formatText('fontFamily'));
        fontSize.addEventListener('change', () => formatText('fontSize'));

        // Brightness and contrast sliders
        brightnessSlider.addEventListener('input', () => {
            brightnessValue.textContent = brightnessSlider.value;
            applyImageFilters();
        });

        contrastSlider.addEventListener('input', () => {
            contrastValue.textContent = contrastSlider.value;
            applyImageFilters();
        });

        // Drag and drop events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        dropArea.addEventListener('drop', handleDrop, false);

        // Functions
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight() {
            dropArea.classList.add('highlight');
        }

        function unhighlight() {
            dropArea.classList.remove('highlight');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                handleFiles(files);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleFiles(files);
            }
        }

        function handleFiles(files) {
            // Reset batch files array if not multiple selection
            if (!fileInput.multiple) {
                batchFilesArray = [];
            }
            
            // Process each file
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (!file.type.match('image.*')) {
                    showStatus('Only image files are supported', 'error');
                    continue;
                }
                
                batchFilesArray.push(file);
            }
            
            if (batchFilesArray.length === 0) return;
            
            // For single file, display it immediately
            if (batchFilesArray.length === 1) {
                displayImage(batchFilesArray[0]);
            } else {
                // For multiple files, show the list
                displayBatchFiles();
            }
        }

        function displayBatchFiles() {
            batchFiles.style.display = 'block';
            batchFileList.innerHTML = '';
            
            batchFilesArray.forEach((file, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'batch-file-item';
                
                const fileInfo = document.createElement('span');
                fileInfo.textContent = `${file.name} (${formatFileSize(file.size)})`;
                
                const fileActions = document.createElement('div');
                fileActions.className = 'batch-file-actions';
                
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn btn-outline';
                viewBtn.innerHTML = '<i>👁️</i>';
                viewBtn.title = 'View';
                viewBtn.onclick = () => displayImage(file);
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-outline';
                removeBtn.innerHTML = '<i>🗑️</i>';
                removeBtn.title = 'Remove';
                removeBtn.onclick = () => removeBatchFile(index);
                
                fileActions.appendChild(viewBtn);
                fileActions.appendChild(removeBtn);
                
                listItem.appendChild(fileInfo);
                listItem.appendChild(fileActions);
                
                batchFileList.appendChild(listItem);
            });
            
            updateUIState();
        }

        function removeBatchFile(index) {
            batchFilesArray.splice(index, 1);
            
            if (batchFilesArray.length === 0) {
                batchFiles.style.display = 'none';
                clearImage();
            } else {
                displayBatchFiles();
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function displayImage(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                currentImage = {
                    file: file,
                    originalSrc: e.target.result,
                    filteredSrc: e.target.result
                };
                
                imagePreview.src = currentImage.filteredSrc;
                imagePreview.style.display = 'block';
                
                // Reset filters
                rotationAngle = 0;
                brightnessSlider.value = 0;
                contrastSlider.value = 100;
                brightnessValue.textContent = '0';
                contrastValue.textContent = '100';
                
                updateUIState();
            };
            
            reader.readAsDataURL(file);
        }

        function handlePaste() {
            navigator.clipboard.readText().then(text => {
                // If text is an image URL
                if (text.match(/\.(jpeg|jpg|gif|png)$/)) {
                    fetch(text)
                        .then(res => res.blob())
                        .then(blob => {
                            const file = new File([blob], "pasted-image.png", { type: blob.type });
                            batchFilesArray = [file];
                            displayImage(file);
                        })
                        .catch(err => {
                            showStatus('Failed to load image from clipboard URL', 'error');
                            console.error(err);
                        });
                } else {
                    showStatus('Clipboard does not contain an image URL', 'warning');
                }
            }).catch(() => {
                // If direct image paste
                document.addEventListener('paste', function onPaste(e) {
                    document.removeEventListener('paste', onPaste);
                    
                    const items = (e.clipboardData || window.clipboardData).items;
                    for (let i = 0; i < items.length; i++) {
                        if (items[i].type.indexOf('image') !== -1) {
                            const blob = items[i].getAsFile();
                            const file = new File([blob], "pasted-image.png", { type: blob.type });
                            batchFilesArray = [file];
                            displayImage(file);
                            return;
                        }
                    }
                    
                    showStatus('No image found in clipboard', 'warning');
                });
                
                // Trigger paste event
                const pasteEvent = new ClipboardEvent('paste');
                document.dispatchEvent(pasteEvent);
            });
        }

        function startCamera() {
            showStatus('Camera access is not fully implemented in this demo', 'warning');
            // Note: Full implementation would use getUserMedia()
        }

        function extractText() {
            if (!currentImage || isProcessing) return;
            
            isProcessing = true;
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = 'Initializing OCR engine...';
            
            const language = languageSelect.value;
            
            Tesseract.recognize(
                currentImage.filteredSrc,
                language,
                {
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            progressBar.style.width = `${Math.round(m.progress * 100)}%`;
                            progressText.textContent = `Processing: ${m.status}`;
                        } else {
                            progressText.textContent = `Status: ${m.status}`;
                        }
                    }
                }
            ).then(({ data: { text, confidence } }) => {
                textOutput.value = text;
                confidenceValue.textContent = confidence.toFixed(1);
                confidenceDisplay.style.display = 'block';
                
                showStatus('Text extraction completed successfully!', 'success');
                updateUIState();
            }).catch(err => {
                console.error(err);
                showStatus('Error during text extraction: ' + err.message, 'error');
            }).finally(() => {
                isProcessing = false;
            });
        }

        function clearImage() {
            currentImage = null;
            imagePreview.src = '';
            imagePreview.style.display = 'none';
            batchFilesArray = [];
            batchFiles.style.display = 'none';
            progressContainer.style.display = 'none';
            updateUIState();
        }

        function clearText() {
            textOutput.value = '';
            confidenceDisplay.style.display = 'none';
            updateUIState();
        }

        function copyText() {
            textOutput.select();
            document.execCommand('copy');
            showStatus('Text copied to clipboard!', 'success');
        }

        function downloadText(format) {
            const text = textOutput.value;
            if (!text.trim()) {
                showStatus('No text to download', 'warning');
                return;
            }
            
            const filename = currentImage ? currentImage.file.name.replace(/\.[^/.]+$/, '') : 'extracted-text';
            
            switch (format) {
                case 'txt':
                    downloadFile(filename + '.txt', 'text/plain', text);
                    break;
                    
                case 'pdf':
                    // Using jsPDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.text(text, 10, 10);
                    doc.save(filename + '.pdf');
                    break;
                    
                case 'docx':
                    // Using docx
                    const { Document, Paragraph, TextRun, Packer } = docx;
                    const docxDoc = new Document({
                        sections: [{
                            properties: {},
                            children: [
                                new Paragraph({
                                    children: [
                                        new TextRun(text)
                                    ]
                                })
                            ]
                        }]
                    });
                    
                    Packer.toBlob(docxDoc).then(blob => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename + '.docx';
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                    break;
            }
            
            showStatus(`Text downloaded as ${format.toUpperCase()}!`, 'success');
        }

        function downloadFile(filename, type, content) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeIcon.textContent = '☀️';
            } else {
                themeIcon.textContent = '🌙';
            }
        }

        function startCropping() {
            showStatus('Image cropping is not implemented in this demo', 'warning');
            // Note: Full implementation would use a library like Cropper.js
        }

        function rotateImage() {
            rotationAngle = (rotationAngle + 90) % 360;
            applyImageFilters();
        }

        function enhanceImage() {
            brightnessSlider.value = 20;
            contrastSlider.value = 120;
            brightnessValue.textContent = '20';
            contrastValue.textContent = '120';
            applyImageFilters();
            showStatus('Image enhanced for better OCR results', 'success');
        }

        function applyImageFilters() {
            if (!currentImage) return;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                // Set canvas size
                if (rotationAngle === 90 || rotationAngle === 270) {
                    canvas.width = img.height;
                    canvas.height = img.width;
                } else {
                    canvas.width = img.width;
                    canvas.height = img.height;
                }
                
                // Apply rotation
                ctx.save();
                if (rotationAngle === 90) {
                    ctx.translate(canvas.width, 0);
                    ctx.rotate(Math.PI / 2);
                } else if (rotationAngle === 180) {
                    ctx.translate(canvas.width, canvas.height);
                    ctx.rotate(Math.PI);
                } else if (rotationAngle === 270) {
                    ctx.translate(0, canvas.height);
                    ctx.rotate(Math.PI * 1.5);
                }
                
                // Draw image
                ctx.drawImage(img, 0, 0);
                ctx.restore();
                
                // Apply brightness and contrast
                const brightness = parseInt(brightnessSlider.value);
                const contrast = parseInt(contrastSlider.value) / 100;
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Apply brightness and contrast to each pixel
                const factor = (259 * (contrast + 255)) / (255 * (259 - contrast));
                
                for (let i = 0; i < data.length; i += 4) {
                    // Red
                    data[i] = factor * (data[i] - 128) + 128 + brightness;
                    // Green
                    data[i+1] = factor * (data[i+1] - 128) + 128 + brightness;
                    // Blue
                    data[i+2] = factor * (data[i+2] - 128) + 128 + brightness;
                    // Alpha remains unchanged
                }
                
                ctx.putImageData(imageData, 0, 0);
                
                // Update preview
                currentImage.filteredSrc = canvas.toDataURL('image/png');
                imagePreview.src = currentImage.filteredSrc;
            };
            
            img.src = currentImage.originalSrc;
        }

        function formatText(command) {
            document.execCommand(command, false, command === 'fontFamily' ? fontFamily.value : 
                                             command === 'fontSize' ? fontSize.value : null);
        }

        function updateUIState() {
            const hasImage = !!currentImage;
            const hasText = textOutput.value.trim() !== '';
            
            // Image tools
            extractBtn.disabled = !hasImage || isProcessing;
            clearBtn.disabled = !hasImage;
            cropBtn.disabled = !hasImage;
            rotateBtn.disabled = !hasImage;
            enhanceBtn.disabled = !hasImage;
            brightnessSlider.disabled = !hasImage;
            contrastSlider.disabled = !hasImage;
            
            // Text tools
            copyBtn.disabled = !hasText;
            downloadTxtBtn.disabled = !hasText;
            downloadPdfBtn.disabled = !hasText;
            downloadDocxBtn.disabled = !hasText;
            clearTextBtn.disabled = !hasText;
            boldBtn.disabled = !hasText;
            italicBtn.disabled = !hasText;
            underlineBtn.disabled = !hasText;
            fontFamily.disabled = !hasText;
            fontSize.disabled = !hasText;
            
            // Update extract button text if processing
            if (isProcessing) {
                extractBtn.innerHTML = '<span class="spinner"></span> Processing...';
                extractBtn.disabled = true;
            } else {
                extractBtn.innerHTML = '<i>🔍</i> Extract Text';
            }
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message status-' + type;
            statusMessage.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>