<div class="separator" style="clear: both;"><a href="https://cdn-icons-png.flaticon.com/128/2554/2554282.png" style="display: block; padding: 1em 0px; text-align: center;"><img alt="" border="0" data-original-height="128" data-original-width="128" src="https://cdn-icons-png.flaticon.com/128/2554/2554282.png" style="display: none;" width="200" /></a></div>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagicRills Pro | AI Story & Poetry Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --primary-light: #8b5cf6;
            --dark: #1e293b;
            --dark-light: #334155;
            --light: #f8fafc;
            --light-dark: #e2e8f0;
            --creative: #db2777;
            --poetry: #059669;
            --danger: #dc2626;
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
            --gray: #64748b;
            --sidebar-width: 280px;
            --header-height: 70px;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: var(--light);
            color: var(--dark);
            transition: all 0.3s;
            line-height: 1.6;
            overflow-x: hidden;
        }
        body.dark-mode {
            background: #0f172a;
            color: #e2e8f0;
        }
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 100;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--dark-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar-header h2 {
            font-size: 1.4rem;
            color: white;
        }
        .sidebar-menu {
            padding: 15px 0;
        }
        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .menu-item:hover {
            background: var(--dark-light);
        }
        .menu-item.active {
            background: var(--dark-light);
            border-left-color: var(--primary);
        }
        .menu-item i {
            width: 20px;
            text-align: center;
        }
        .sidebar-footer {
            padding: 20px;
            margin-top: auto;
            border-top: 1px solid var(--dark-light);
            font-size: 0.85rem;
            color: var(--gray);
        }
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
        }
        .header {
            height: var(--header-height);
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 99;
        }
        .dark-mode .header {
            background: var(--dark);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--primary);
            cursor: pointer;
        }
        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .content {
            padding: 25px;
        }
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .dark-mode .card {
            background: var(--dark);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        .dark-mode .card-title {
            color: var(--light);
        }
        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        .card-icon.primary {
            background: var(--primary);
        }
        .card-icon.success {
            background: var(--success);
        }
        .card-icon.warning {
            background: var(--warning);
        }
        .card-icon.info {
            background: var(--info);
        }
        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .card-footer {
            font-size: 0.85rem;
            color: var(--gray);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            background: white;
            position: relative;
        }
        .dark-mode .container {
            background: var(--dark);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 2.2rem;
        }
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .mode-toggle {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tool-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        .input-section, .output-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        textarea, input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            background: white;
        }
        textarea {
            min-height: 250px;
            resize: vertical;
        }
        .dark-mode textarea, .dark-mode input, .dark-mode select {
            background: var(--dark-light);
            color: #e2e8f0;
            border-color: #475569;
        }
        .btn {
            padding: 12px 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .btn-creative {
            background: var(--creative);
        }
        .btn-creative:hover {
            background: #be185d;
        }
        .btn-poetry {
            background: var(--poetry);
        }
        .btn-poetry:hover {
            background: #047857;
        }
        .btn-danger {
            background: var(--danger);
        }
        .btn-danger:hover {
            background: #b91c1c;
        }
        .btn-success {
            background: var(--success);
        }
        .btn-success:hover {
            background: #0d9669;
        }
        .btn-warning {
            background: var(--warning);
        }
        .btn-warning:hover {
            background: #d97706;
        }
        .btn-info {
            background: var(--info);
        }
        .btn-info:hover {
            background: #2563eb;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .story-output, .poem-output {
            margin-top: 20px;
            padding: 20px;
            border-radius: 5px;
            background: #f1f5f9;
            white-space: pre-line;
            line-height: 1.8;
            font-size: 1.05rem;
        }
        .dark-mode .story-output, .dark-mode .poem-output {
            background: var(--dark-light);
        }
        .story-output {
            border-left: 5px solid var(--primary);
        }
        .poem-output {
            border-left: 5px solid var(--poetry);
            font-style: italic;
            line-height: 2;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 200px;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .stat-box {
            text-align: center;
            padding: 12px;
            border-radius: 5px;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            flex: 1;
            min-width: 120px;
        }
        .dark-mode .stat-box {
            background: var(--dark-light);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .stat-box h3 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        .stat-box p {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .advanced-options {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            background: #f1f5f9;
            border: 1px dashed #ccc;
        }
        .dark-mode .advanced-options {
            background: var(--dark-light);
            border-color: #475569;
        }
        .toggle-advanced {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
            margin-top: 5px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .character-card {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 5px;
            align-items: center;
        }
        .dark-mode .character-card {
            background: var(--dark-light);
        }
        .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }
        .character-details {
            flex: 1;
        }
        .character-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .character-traits {
            font-size: 0.9rem;
            color: #64748b;
        }
        .dark-mode .character-traits {
            color: #94a3b8;
        }
        .plot-points {
            margin-top: 15px;
        }
        .plot-point {
            padding: 10px;
            margin-bottom: 10px;
            background: #f1f5f9;
            border-left: 3px solid var(--primary);
            border-radius: 0 5px 5px 0;
        }
        .dark-mode .plot-point {
            background: var(--dark-light);
        }
        .tab-container {
            display: flex;
            border-bottom: 1px solid #ccc;
            margin-bottom: 15px;
        }
        .dark-mode .tab-container {
            border-bottom-color: #475569;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab.active {
            border-bottom-color: var(--primary);
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .api-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #f1f5f9;
        }
        .dark-mode .api-section {
            background: var(--dark-light);
        }
        .api-key-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .api-key-input input {
            flex: 1;
        }
        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger);
        }
        .status-indicator.connected {
            background: var(--success);
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .history-item {
            padding: 15px;
            border-radius: 5px;
            background: white;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s;
        }
        .dark-mode .history-item {
            background: var(--dark-light);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .history-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary);
        }
        .history-preview {
            font-size: 0.9rem;
            color: var(--gray);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .history-date {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        .settings-group {
            margin-bottom: 20px;
        }
        .settings-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }
        .settings-description {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .menu-toggle {
                display: block;
            }
            .container {
                padding: 15px;
                margin: 10px;
            }
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            .control-group {
                min-width: 100%;
            }
            .btn-group {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-magic"></i>
                <h2>MagicRills Pro</h2>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-page="generator">
                    <i class="fas fa-wand-magic-sparkles"></i>
                    <span>Content Generator</span>
                </div>
                <div class="menu-item" data-page="history">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </div>
                <div class="menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="menu-item" data-page="api">
                    <i class="fas fa-key"></i>
                    <span>API Configuration</span>
                </div>
            </div>
            <div class="sidebar-footer">
                <p>MagicRills Pro v2.0</p>
                <p>Powered by DeepSeek AI</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-title" id="pageTitle">Dashboard</div>
                </div>
                <div class="header-right">
                    <button class="mode-toggle" id="modeToggle">
                        <i class="fas fa-moon"></i> Dark Mode
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar">U</div>
                        <span>User</span>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- Dashboard Page -->
                <div class="page active" id="dashboard-page">
                    <h1>Welcome to MagicRills Pro</h1>
                    <p class="subtitle">Advanced AI Story & Poetry Generator</p>
                    
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Stories Generated</div>
                                <div class="card-icon primary">
                                    <i class="fas fa-book"></i>
                                </div>
                            </div>
                            <div class="card-value" id="storiesCount">24</div>
                            <div class="card-footer">Total stories created</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Poems Generated</div>
                                <div class="card-icon success">
                                    <i class="fas fa-pen-nib"></i>
                                </div>
                            </div>
                            <div class="card-value" id="poemsCount">18</div>
                            <div class="card-footer">Total poems created</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">API Usage</div>
                                <div class="card-icon warning">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="card-value" id="apiUsage">87%</div>
                            <div class="card-footer">This month's usage</div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Words Generated</div>
                                <div class="card-icon info">
                                    <i class="fas fa-font"></i>
                                </div>
                            </div>
                            <div class="card-value" id="wordsCount">12,458</div>
                            <div class="card-footer">Total words created</div>
                        </div>
                    </div>

                    <div class="container">
                        <h2>Quick Start</h2>
                        <p>Get started by generating your first story or poem with our AI-powered tool.</p>
                        
                        <div class="btn-group" style="margin-top: 20px;">
                            <button class="btn" onclick="switchPage('generator')">
                                <i class="fas fa-wand-magic-sparkles"></i> Generate Story
                            </button>
                            <button class="btn btn-poetry" onclick="switchPage('generator')">
                                <i class="fas fa-pen-nib"></i> Generate Poem
                            </button>
                            <button class="btn btn-info" onclick="switchPage('api')">
                                <i class="fas fa-key"></i> Configure API
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Generator Page -->
                <div class="page" id="generator-page">
                    <div class="container">
                        <h1>MagicRills Pro ✨<br>Advanced Story & Poetry Generator</h1>
                        
                        <div class="tool-container">
                            <div class="input-section">
                                <div class="controls">
                                    <div class="control-group">
                                        <label for="themeInput">Main Theme/Concept</label>
                                        <input id="themeInput" placeholder="e.g., 'A haunted castle', 'Interstellar travel'" type="text" />
                                    </div>
                                    <div class="control-group">
                                        <label for="genreSelect">Genre</label>
                                        <select id="genreSelect">
                                            <option value="fantasy">Fantasy</option>
                                            <option value="scifi">Sci-Fi</option>
                                            <option value="romance">Romance</option>
                                            <option value="horror">Horror</option>
                                            <option value="mystery">Mystery</option>
                                            <option value="adventure">Adventure</option>
                                            <option value="historical">Historical</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label for="lengthSelect">Length</label>
                                        <select id="lengthSelect">
                                            <option value="short">Short (1 paragraph)</option>
                                            <option value="medium">Medium (3 paragraphs)</option>
                                            <option value="long">Long (5+ paragraphs)</option>
                                            <option value="chapter">Chapter (8+ paragraphs)</option>
                                        </select>
                                    </div>
                                </div>

                                <button class="toggle-advanced" id="toggleAdvanced">
                                    <span id="advancedIcon">▼</span> Advanced Options
                                </button>

                                <div class="advanced-options" id="advancedOptions" style="display: none;">
                                    <div class="controls">
                                        <div class="control-group">
                                            <label for="protagonistInput">Protagonist</label>
                                            <input id="protagonistInput" placeholder="e.g., 'a young wizard', 'cyborg detective'" type="text" />
                                        </div>
                                        <div class="control-group">
                                            <label for="antagonistInput">Antagonist</label>
                                            <input id="antagonistInput" placeholder="e.g., 'dark lord', 'rogue AI'" type="text" />
                                        </div>
                                        <div class="control-group">
                                            <label for="toneSelect">Tone</label>
                                            <select id="toneSelect">
                                                <option value="neutral">Neutral</option>
                                                <option value="humorous">Humorous</option>
                                                <option value="dark">Dark</option>
                                                <option value="poetic">Poetic</option>
                                                <option value="epic">Epic</option>
                                                <option value="gritty">Gritty</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label for="writingStyle">Writing Style</label>
                                        <select id="writingStyle">
                                            <option value="modern">Modern</option>
                                            <option value="classic">Classic</option>
                                            <option value="minimalist">Minimalist</option>
                                            <option value="descriptive">Descriptive</option>
                                            <option value="noir">Noir</option>
                                            <option value="epistolary">Epistolary (Letters/Journals)</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label for="poemType" style="display: none;" id="poemTypeLabel">Poem Type</label>
                                        <select id="poemType" style="display: none;">
                                            <option value="free">Free Verse</option>
                                            <option value="sonnet">Sonnet</option>
                                            <option value="haiku">Haiku</option>
                                            <option value="limerick">Limerick</option>
                                            <option value="ballad">Ballad</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="btn-group">
                                    <button class="btn" id="generateStory">
                                        <i class="fas fa-book"></i> Generate Story
                                    </button>
                                    <button class="btn btn-poetry" id="generatePoem">
                                        <i class="fas fa-pen-nib"></i> Generate Poem
                                    </button>
                                    <button class="btn btn-creative" id="generatePrompt">
                                        <i class="fas fa-lightbulb"></i> Writing Prompt
                                    </button>
                                    <button class="btn btn-danger" id="clearAll">
                                        <i class="fas fa-trash"></i> Clear All
                                    </button>
                                </div>
                            </div>
                            
                            <div class="loading" id="loadingIndicator">
                                <div class="loading-spinner"></div>
                                <p>Generating your content with AI...</p>
                            </div>
                            
                            <div class="output-section" id="outputSection" style="display: none;">
                                <div class="tab-container">
                                    <div class="tab active" data-tab="output">Output</div>
                                    <div class="tab" data-tab="characters">Characters</div>
                                    <div class="tab" data-tab="plot">Plot Structure</div>
                                </div>
                                
                                <div class="tab-content active" data-tab-content="output">
                                    <h2 id="outputTitle">Your Generated Story</h2>
                                    <div class="story-output" id="storyOutput"></div>
                                    <div class="poem-output" id="poemOutput" style="display: none;"></div>
                                    
                                    <div class="stats">
                                        <div class="stat-box">
                                            <h3>Words</h3>
                                            <p id="wordCount">0</p>
                                        </div>
                                        <div class="stat-box">
                                            <h3>Characters</h3>
                                            <p id="charCount">0</p>
                                        </div>
                                        <div class="stat-box">
                                            <h3>Reading Time</h3>
                                            <p id="readingTime">~0 min</p>
                                        </div>
                                        <div class="stat-box">
                                            <h3>Sentences</h3>
                                            <p id="sentenceCount">0</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-content" data-tab-content="characters" id="charactersTab">
                                    <h2>Generated Characters</h2>
                                    <div id="characterOutput"></div>
                                </div>
                                
                                <div class="tab-content" data-tab-content="plot" id="plotTab">
                                    <h2>Plot Structure</h2>
                                    <div id="plotOutput"></div>
                                </div>

                                <div class="btn-group">
                                    <button class="btn" id="copyOutput">
                                        <i class="fas fa-copy"></i> Copy Text
                                    </button>
                                    <button class="btn btn-success" id="exportOutput">
                                        <i class="fas fa-download"></i> Export as TXT
                                    </button>
                                    <button class="btn" id="exportPDF" style="display: none;">
                                        <i class="fas fa-file-pdf"></i> Export as PDF
                                    </button>
                                    <button class="btn btn-creative" id="continueStory" style="display: none;">
                                        <i class="fas fa-play"></i> Continue Story
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History Page -->
                <div class="page" id="history-page">
                    <div class="container">
                        <h1>Generation History</h1>
                        <p>Review your previously generated stories and poems.</p>
                        
                        <div class="controls" style="margin-top: 20px;">
                            <div class="control-group">
                                <label for="historyFilter">Filter by Type</label>
                                <select id="historyFilter">
                                    <option value="all">All Content</option>
                                    <option value="story">Stories Only</option>
                                    <option value="poem">Poems Only</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="historySearch">Search</label>
                                <input id="historySearch" placeholder="Search by title or content..." type="text" />
                            </div>
                        </div>
                        
                        <div id="historyList" style="margin-top: 20px;">
                            <!-- History items will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page" id="settings-page">
                    <div class="container">
                        <h1>Settings</h1>
                        <p>Customize your MagicRills Pro experience.</p>
                        
                        <div class="settings-group">
                            <label class="settings-label">Auto-save generated content</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoSave" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="settings-description">Automatically save your generated stories and poems to history.</div>
                        </div>
                        
                        <div class="settings-group">
                            <label class="settings-label">Show advanced options by default</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showAdvanced">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="settings-description">Display advanced options when opening the generator.</div>
                        </div>
                        
                        <div class="settings-group">
                            <label class="settings-label">Enable text-to-speech</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="textToSpeech">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="settings-description">Allow reading generated content aloud.</div>
                        </div>
                        
                        <div class="settings-group">
                            <label class="settings-label">Dark mode</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="settings-description">Switch between light and dark themes.</div>
                        </div>
                        
                        <div class="btn-group" style="margin-top: 30px;">
                            <button class="btn btn-success" id="saveSettings">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            <button class="btn btn-danger" id="resetSettings">
                                <i class="fas fa-undo"></i> Reset to Defaults
                            </button>
                        </div>
                    </div>
                </div>

                <!-- API Configuration Page -->
                <div class="page" id="api-page">
                    <div class="container">
                        <h1>API Configuration</h1>
                        <p>Configure your DeepSeek API settings for enhanced AI generation.</p>
                        
                        <div class="api-section">
                            <h2>DeepSeek API Settings</h2>
                            
                            <div class="control-group">
                                <label for="apiKeyInput">API Key</label>
                                <div class="api-key-input">
                                    <input id="apiKeyInput" type="password" placeholder="Enter your DeepSeek API key" value="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" />
                                    <button class="btn" id="toggleApiKey">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="settings-description">Your API key is stored locally in your browser and never shared.</div>
                            </div>
                            
                            <div class="control-group">
                                <label for="apiModel">Model</label>
                                <select id="apiModel">
                                    <option value="deepseek/deepseek-chat-v3.1:free">DeepSeek Chat v3.1 (Free)</option>
                                    <option value="deepseek/deepseek-chat-v3.1">DeepSeek Chat v3.1</option>
                                    <option value="deepseek/deepseek-coder-v2">DeepSeek Coder v2</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label for="maxTokens">Max Tokens</label>
                                <input id="maxTokens" type="number" value="1000" min="100" max="4000" />
                                <div class="settings-description">Maximum length of the generated response (100-4000 tokens).</div>
                            </div>
                            
                            <div class="control-group">
                                <label for="temperature">Temperature</label>
                                <input id="temperature" type="range" min="0" max="1" step="0.1" value="0.7" />
                                <div class="settings-description" id="temperatureValue">Creativity level: 0.7 (higher = more creative, lower = more focused)</div>
                            </div>
                            
                            <div class="api-status">
                                <div class="status-indicator" id="apiStatusIndicator"></div>
                                <span id="apiStatusText">API Status: Not Connected</span>
                            </div>
                            
                            <div class="btn-group" style="margin-top: 20px;">
                                <button class="btn btn-success" id="testApi">
                                    <i class="fas fa-plug"></i> Test Connection
                                </button>
                                <button class="btn" id="saveApiSettings">
                                    <i class="fas fa-save"></i> Save API Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const modeToggle = document.getElementById('modeToggle');
        const pages = document.querySelectorAll('.page');
        const menuItems = document.querySelectorAll('.menu-item');
        const pageTitle = document.getElementById('pageTitle');
        const toggleAdvanced = document.getElementById('toggleAdvanced');
        const advancedOptions = document.getElementById('advancedOptions');
        const advancedIcon = document.getElementById('advancedIcon');
        const generateStoryBtn = document.getElementById('generateStory');
        const generatePoemBtn = document.getElementById('generatePoem');
        const generatePromptBtn = document.getElementById('generatePrompt');
        const clearAllBtn = document.getElementById('clearAll');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const outputSection = document.getElementById('outputSection');
        const storyOutput = document.getElementById('storyOutput');
        const poemOutput = document.getElementById('poemOutput');
        const outputTitle = document.getElementById('outputTitle');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        const readingTime = document.getElementById('readingTime');
        const sentenceCount = document.getElementById('sentenceCount');
        const copyOutputBtn = document.getElementById('copyOutput');
        const exportOutputBtn = document.getElementById('exportOutput');
        const continueStoryBtn = document.getElementById('continueStory');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const toggleApiKeyBtn = document.getElementById('toggleApiKey');
        const testApiBtn = document.getElementById('testApi');
        const saveApiSettingsBtn = document.getElementById('saveApiSettings');
        const apiStatusIndicator = document.getElementById('apiStatusIndicator');
        const apiStatusText = document.getElementById('apiStatusText');
        const temperatureSlider = document.getElementById('temperature');
        const temperatureValue = document.getElementById('temperatureValue');
        const poemType = document.getElementById('poemType');
        const poemTypeLabel = document.getElementById('poemTypeLabel');
        const historyList = document.getElementById('historyList');
        const historyFilter = document.getElementById('historyFilter');
        const historySearch = document.getElementById('historySearch');
        const saveSettingsBtn = document.getElementById('saveSettings');
        const resetSettingsBtn = document.getElementById('resetSettings');
        const darkModeToggle = document.getElementById('darkModeToggle');

        // App State
        let currentPage = 'dashboard';
        let isDarkMode = false;
        let isApiConnected = false;
        let currentContentType = 'story';
        let generationHistory = [];

        // Initialize the app
        function initApp() {
            // Load settings from localStorage
            loadSettings();
            
            // Set up event listeners
            setupEventListeners();
            
            // Load generation history
            loadHistory();
            
            // Update dashboard stats
            updateDashboardStats();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Menu toggle
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });

            // Dark mode toggle
            modeToggle.addEventListener('click', toggleDarkMode);
            darkModeToggle.addEventListener('change', toggleDarkMode);

            // Menu items for page navigation
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.getAttribute('data-page');
                    switchPage(page);
                });
            });

            // Advanced options toggle
            toggleAdvanced.addEventListener('click', () => {
                const isVisible = advancedOptions.style.display === 'block';
                advancedOptions.style.display = isVisible ? 'none' : 'block';
                advancedIcon.textContent = isVisible ? '▼' : '▲';
            });

            // Content generation buttons
            generateStoryBtn.addEventListener('click', () => {
                currentContentType = 'story';
                generateContent('story');
            });

            generatePoemBtn.addEventListener('click', () => {
                currentContentType = 'poem';
                generateContent('poem');
            });

            generatePromptBtn.addEventListener('click', () => {
                currentContentType = 'prompt';
                generateContent('prompt');
            });

            clearAllBtn.addEventListener('click', clearAll);

            // Output actions
            copyOutputBtn.addEventListener('click', copyOutput);
            exportOutputBtn.addEventListener('click', exportOutput);
            continueStoryBtn.addEventListener('click', continueStory);

            // Tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // API settings
            toggleApiKeyBtn.addEventListener('click', () => {
                const type = apiKeyInput.getAttribute('type') === 'password' ? 'text' : 'password';
                apiKeyInput.setAttribute('type', type);
                toggleApiKeyBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });

            testApiBtn.addEventListener('click', testApiConnection);
            saveApiSettingsBtn.addEventListener('click', saveApiSettings);

            // Temperature slider
            temperatureSlider.addEventListener('input', () => {
                const value = temperatureSlider.value;
                temperatureValue.textContent = `Creativity level: ${value} (higher = more creative, lower = more focused)`;
            });

            // History filter and search
            historyFilter.addEventListener('change', loadHistory);
            historySearch.addEventListener('input', loadHistory);

            // Settings
            saveSettingsBtn.addEventListener('click', saveSettings);
            resetSettingsBtn.addEventListener('click', resetSettings);
        }

        // Switch between pages
        function switchPage(page) {
            // Update current page
            currentPage = page;
            
            // Hide all pages
            pages.forEach(p => p.classList.remove('active'));
            
            // Show selected page
            document.getElementById(`${page}-page`).classList.add('active');
            
            // Update active menu item
            menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                }
            });
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                generator: 'Content Generator',
                history: 'History',
                settings: 'Settings',
                api: 'API Configuration'
            };
            pageTitle.textContent = titles[page];
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('open');
            }
            
            // Special handling for generator page
            if (page === 'generator') {
                // Show/hide poem type based on content type
                if (currentContentType === 'poem') {
                    poemType.style.display = 'block';
                    poemTypeLabel.style.display = 'block';
                } else {
                    poemType.style.display = 'none';
                    poemTypeLabel.style.display = 'none';
                }
            }
            
            // Load history when switching to history page
            if (page === 'history') {
                loadHistory();
            }
        }

        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            // Update toggle state
            if (darkModeToggle) {
                darkModeToggle.checked = isDarkMode;
            }
            
            // Save setting
            saveSetting('darkMode', isDarkMode);
        }

        // Switch between tabs
        function switchTab(tabName) {
            // Update active tab
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
            });
            
            // Show active tab content
            tabContents.forEach(content => {
                content.classList.toggle('active', content.getAttribute('data-tab-content') === tabName);
            });
        }

        // Generate content using DeepSeek API
        async function generateContent(type) {
            // Get input values
            const theme = document.getElementById('themeInput').value.trim();
            const genre = document.getElementById('genreSelect').value;
            const length = document.getElementById('lengthSelect').value;
            const protagonist = document.getElementById('protagonistInput').value.trim();
            const antagonist = document.getElementById('antagonistInput').value.trim();
            const tone = document.getElementById('toneSelect').value;
            const writingStyle = document.getElementById('writingStyle').value;
            const poemTypeValue = document.getElementById('poemType').value;
            
            // Validate input
            if (!theme) {
                alert('Please enter a theme or concept for your content.');
                return;
            }
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            outputSection.style.display = 'none';
            
            try {
                // Prepare prompt based on content type
                let prompt = '';
                let systemPrompt = '';
                
                if (type === 'story') {
                    systemPrompt = 'You are a creative writing assistant that generates engaging stories.';
                    prompt = `Write a ${length} ${genre} story about ${theme}.`;
                    
                    if (protagonist) prompt += ` The protagonist is ${protagonist}.`;
                    if (antagonist) prompt += ` The antagonist is ${antagonist}.`;
                    if (tone !== 'neutral') prompt += ` The tone should be ${tone}.`;
                    if (writingStyle !== 'modern') prompt += ` Write in a ${writingStyle} style.`;
                    
                    prompt += ` Make the story engaging and well-structured.`;
                } else if (type === 'poem') {
                    systemPrompt = 'You are a poet that creates beautiful and meaningful poems.';
                    prompt = `Write a ${poemTypeValue} poem about ${theme}.`;
                    
                    if (tone !== 'neutral') prompt += ` The tone should be ${tone}.`;
                    if (writingStyle !== 'modern') prompt += ` Write in a ${writingStyle} style.`;
                    
                    prompt += ` Make the poem evocative and impactful.`;
                } else if (type === 'prompt') {
                    systemPrompt = 'You are a creative writing coach that generates inspiring writing prompts.';
                    prompt = `Create a creative writing prompt based on the theme: ${theme}.`;
                    
                    if (genre !== 'fantasy') prompt += ` The genre should be ${genre}.`;
                    if (protagonist) prompt += ` Include a protagonist who is ${protagonist}.`;
                    
                    prompt += ` Make the prompt inspiring and open to interpretation.`;
                }
                
                // Get API settings
                const apiKey = document.getElementById('apiKeyInput').value;
                const model = document.getElementById('apiModel').value;
                const maxTokens = parseInt(document.getElementById('maxTokens').value);
                const temperature = parseFloat(document.getElementById('temperature').value);
                
                // Call DeepSeek API
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "HTTP-Referer": window.location.href,
                        "X-Title": "MagicRills Pro",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": model,
                        "messages": [
                            {
                                "role": "system",
                                "content": systemPrompt
                            },
                            {
                                "role": "user",
                                "content": prompt
                            }
                        ],
                        "max_tokens": maxTokens,
                        "temperature": temperature
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Extract the generated content
                const generatedText = data.choices[0].message.content;
                
                // Display the generated content
                displayGeneratedContent(type, generatedText, theme);
                
                // Save to history
                saveToHistory(type, theme, generatedText);
                
                // Update dashboard stats
                updateDashboardStats();
                
            } catch (error) {
                console.error('Error generating content:', error);
                alert(`Failed to generate content: ${error.message}. Please check your API key and connection.`);
            } finally {
                // Hide loading indicator
                loadingIndicator.style.display = 'none';
            }
        }

        // Display generated content
        function displayGeneratedContent(type, content, theme) {
            // Show output section
            outputSection.style.display = 'block';
            
            // Set output title
            if (type === 'story') {
                outputTitle.textContent = `Your Generated Story: ${theme}`;
                storyOutput.textContent = content;
                storyOutput.style.display = 'block';
                poemOutput.style.display = 'none';
                continueStoryBtn.style.display = 'inline-flex';
            } else if (type === 'poem') {
                outputTitle.textContent = `Your Generated Poem: ${theme}`;
                poemOutput.textContent = content;
                poemOutput.style.display = 'block';
                storyOutput.style.display = 'none';
                continueStoryBtn.style.display = 'none';
            } else if (type === 'prompt') {
                outputTitle.textContent = `Your Writing Prompt: ${theme}`;
                storyOutput.textContent = content;
                storyOutput.style.display = 'block';
                poemOutput.style.display = 'none';
                continueStoryBtn.style.display = 'none';
            }
            
            // Calculate and display stats
            const text = type === 'poem' ? poemOutput.textContent : storyOutput.textContent;
            updateTextStats(text);
            
            // Generate character and plot information for stories
            if (type === 'story') {
                generateCharacterInfo(theme, content);
                generatePlotInfo(content);
            } else {
                document.getElementById('characterOutput').innerHTML = '<p>Character information is only available for stories.</p>';
                document.getElementById('plotOutput').innerHTML = '<p>Plot structure is only available for stories.</p>';
            }
            
            // Switch to output tab
            switchTab('output');
        }

        // Update text statistics
        function updateTextStats(text) {
            // Word count
            const words = text.trim().split(/\s+/).length;
            wordCount.textContent = words;
            
            // Character count
            const chars = text.length;
            charCount.textContent = chars;
            
            // Reading time (assuming 200 words per minute)
            const readingTimeMinutes = Math.ceil(words / 200);
            readingTime.textContent = `~${readingTimeMinutes} min`;
            
            // Sentence count
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            sentenceCount.textContent = sentences;
        }

        // Generate character information
        function generateCharacterInfo(theme, content) {
            // This is a simplified version - in a real app, you would call the API for this
            const characters = [
                {
                    name: 'Main Character',
                    traits: 'Determined, curious, resourceful',
                    role: 'Protagonist'
                },
                {
                    name: 'Opposing Force',
                    traits: 'Mysterious, powerful, enigmatic',
                    role: 'Antagonist'
                }
            ];
            
            let characterHTML = '';
            characters.forEach((char, index) => {
                characterHTML += `
                    <div class="character-card">
                        <div class="character-avatar">${char.name.charAt(0)}</div>
                        <div class="character-details">
                            <div class="character-name">${char.name}</div>
                            <div class="character-traits">${char.traits}</div>
                            <div class="character-role">${char.role}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('characterOutput').innerHTML = characterHTML;
        }

        // Generate plot information
        function generatePlotInfo(content) {
            // This is a simplified version - in a real app, you would call the API for this
            const plotPoints = [
                'Introduction of the main character and setting',
                'Inciting incident that sets the story in motion',
                'Rising action with increasing tension',
                'Climax where the main conflict reaches its peak',
                'Falling action and resolution'
            ];
            
            let plotHTML = '';
            plotPoints.forEach((point, index) => {
                plotHTML += `
                    <div class="plot-point">
                        <strong>${index + 1}. ${point}</strong>
                    </div>
                `;
            });
            
            document.getElementById('plotOutput').innerHTML = plotHTML;
        }

        // Copy output to clipboard
        function copyOutput() {
            const textToCopy = currentContentType === 'poem' ? 
                poemOutput.textContent : storyOutput.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Show success feedback
                const originalText = copyOutputBtn.innerHTML;
                copyOutputBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    copyOutputBtn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy text to clipboard');
            });
        }

        // Export output as text file
        function exportOutput() {
            const textToExport = currentContentType === 'poem' ? 
                poemOutput.textContent : storyOutput.textContent;
            
            const title = outputTitle.textContent;
            const blob = new Blob([textToExport], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/\s+/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Continue the current story
        function continueStory() {
            if (currentContentType !== 'story') return;
            
            const currentStory = storyOutput.textContent;
            const theme = document.getElementById('themeInput').value.trim();
            
            // Add a continuation prompt
            document.getElementById('themeInput').value = `${theme} - continuation`;
            
            // Generate more content
            generateContent('story');
        }

        // Clear all inputs and outputs
        function clearAll() {
            document.getElementById('themeInput').value = '';
            document.getElementById('protagonistInput').value = '';
            document.getElementById('antagonistInput').value = '';
            outputSection.style.display = 'none';
        }

        // Test API connection
        async function testApiConnection() {
            const apiKey = document.getElementById('apiKeyInput').value;
            
            if (!apiKey) {
                alert('Please enter your API key first.');
                return;
            }
            
            testApiBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
            testApiBtn.disabled = true;
            
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "HTTP-Referer": window.location.href,
                        "X-Title": "MagicRills Pro",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "deepseek/deepseek-chat-v3.1:free",
                        "messages": [
                            {
                                "role": "user",
                                "content": "Hello, please respond with just 'OK' to confirm the API is working."
                            }
                        ],
                        "max_tokens": 10
                    })
                });
                
                if (response.ok) {
                    isApiConnected = true;
                    apiStatusIndicator.classList.add('connected');
                    apiStatusText.textContent = 'API Status: Connected';
                    alert('API connection successful!');
                } else {
                    throw new Error(`API returned status: ${response.status}`);
                }
            } catch (error) {
                console.error('API test failed:', error);
                isApiConnected = false;
                apiStatusIndicator.classList.remove('connected');
                apiStatusText.textContent = 'API Status: Connection Failed';
                alert(`API connection failed: ${error.message}`);
            } finally {
                testApiBtn.innerHTML = '<i class="fas fa-plug"></i> Test Connection';
                testApiBtn.disabled = false;
            }
        }

        // Save API settings
        function saveApiSettings() {
            const apiKey = document.getElementById('apiKeyInput').value;
            const model = document.getElementById('apiModel').value;
            const maxTokens = document.getElementById('maxTokens').value;
            const temperature = document.getElementById('temperature').value;
            
            // Save to localStorage
            localStorage.setItem('magicRillsApiKey', apiKey);
            localStorage.setItem('magicRillsModel', model);
            localStorage.setItem('magicRillsMaxTokens', maxTokens);
            localStorage.setItem('magicRillsTemperature', temperature);
            
            alert('API settings saved successfully!');
        }

        // Save to generation history
        function saveToHistory(type, theme, content) {
            const historyItem = {
                id: Date.now(),
                type: type,
                theme: theme,
                content: content,
                date: new Date().toLocaleString(),
                wordCount: content.trim().split(/\s+/).length
            };
            
            generationHistory.unshift(historyItem);
            
            // Keep only the last 50 items
            if (generationHistory.length > 50) {
                generationHistory = generationHistory.slice(0, 50);
            }
            
            // Save to localStorage
            localStorage.setItem('magicRillsHistory', JSON.stringify(generationHistory));
        }

        // Load generation history
        function loadHistory() {
            // Get history from localStorage
            const savedHistory = localStorage.getItem('magicRillsHistory');
            if (savedHistory) {
                generationHistory = JSON.parse(savedHistory);
            }
            
            // Apply filters
            const filter = document.getElementById('historyFilter').value;
            const search = document.getElementById('historySearch').value.toLowerCase();
            
            let filteredHistory = generationHistory;
            
            if (filter !== 'all') {
                filteredHistory = filteredHistory.filter(item => item.type === filter);
            }
            
            if (search) {
                filteredHistory = filteredHistory.filter(item => 
                    item.theme.toLowerCase().includes(search) || 
                    item.content.toLowerCase().includes(search)
                );
            }
            
            // Display history
            let historyHTML = '';
            
            if (filteredHistory.length === 0) {
                historyHTML = '<p>No generation history found.</p>';
            } else {
                filteredHistory.forEach(item => {
                    const preview = item.content.length > 100 ? 
                        item.content.substring(0, 100) + '...' : item.content;
                    
                    historyHTML += `
                        <div class="history-item" data-id="${item.id}">
                            <div class="history-title">${item.theme} (${item.type})</div>
                            <div class="history-preview">${preview}</div>
                            <div class="history-date">${item.date} • ${item.wordCount} words</div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('historyList').innerHTML = historyHTML;
            
            // Add click events to history items
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = parseInt(item.getAttribute('data-id'));
                    const historyItem = generationHistory.find(h => h.id === id);
                    
                    if (historyItem) {
                        // Switch to generator page
                        switchPage('generator');
                        
                        // Set the theme
                        document.getElementById('themeInput').value = historyItem.theme;
                        
                        // Display the content
                        displayGeneratedContent(historyItem.type, historyItem.content, historyItem.theme);
                    }
                });
            });
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            // Get history from localStorage
            const savedHistory = localStorage.getItem('magicRillsHistory');
            let history = [];
            
            if (savedHistory) {
                history = JSON.parse(savedHistory);
            }
            
            // Calculate stats
            const storiesCount = history.filter(item => item.type === 'story').length;
            const poemsCount = history.filter(item => item.type === 'poem').length;
            const promptsCount = history.filter(item => item.type === 'prompt').length;
            const totalWords = history.reduce((sum, item) => sum + item.wordCount, 0);
            
            // Update dashboard
            document.getElementById('storiesCount').textContent = storiesCount;
            document.getElementById('poemsCount').textContent = poemsCount;
            document.getElementById('wordsCount').textContent = totalWords.toLocaleString();
            
            // Calculate API usage (simulated)
            const usage = Math.min(100, Math.floor(totalWords / 100));
            document.getElementById('apiUsage').textContent = `${usage}%`;
        }

        // Load settings from localStorage
        function loadSettings() {
            // Dark mode
            const darkMode = localStorage.getItem('magicRillsDarkMode') === 'true';
            if (darkMode) {
                toggleDarkMode();
            }
            
            // API settings
            const apiKey = localStorage.getItem('magicRillsApiKey');
            if (apiKey) {
                document.getElementById('apiKeyInput').value = apiKey;
            }
            
            const model = localStorage.getItem('magicRillsModel');
            if (model) {
                document.getElementById('apiModel').value = model;
            }
            
            const maxTokens = localStorage.getItem('magicRillsMaxTokens');
            if (maxTokens) {
                document.getElementById('maxTokens').value = maxTokens;
            }
            
            const temperature = localStorage.getItem('magicRillsTemperature');
            if (temperature) {
                document.getElementById('temperature').value = temperature;
                temperatureValue.textContent = `Creativity level: ${temperature} (higher = more creative, lower = more focused)`;
            }
            
            // Other settings
            const autoSave = localStorage.getItem('magicRillsAutoSave');
            if (autoSave !== null) {
                document.getElementById('autoSave').checked = autoSave === 'true';
            }
            
            const showAdvanced = localStorage.getItem('magicRillsShowAdvanced');
            if (showAdvanced !== null) {
                document.getElementById('showAdvanced').checked = showAdvanced === 'true';
            }
            
            const textToSpeech = localStorage.getItem('magicRillsTextToSpeech');
            if (textToSpeech !== null) {
                document.getElementById('textToSpeech').checked = textToSpeech === 'true';
            }
        }

        // Save a single setting
        function saveSetting(key, value) {
            localStorage.setItem(`magicRills${key.charAt(0).toUpperCase() + key.slice(1)}`, value);
        }

        // Save all settings
        function saveSettings() {
            saveSetting('autoSave', document.getElementById('autoSave').checked);
            saveSetting('showAdvanced', document.getElementById('showAdvanced').checked);
            saveSetting('textToSpeech', document.getElementById('textToSpeech').checked);
            saveSetting('darkMode', document.getElementById('darkModeToggle').checked);
            
            alert('Settings saved successfully!');
        }

        // Reset settings to defaults
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to their default values?')) {
                localStorage.removeItem('magicRillsAutoSave');
                localStorage.removeItem('magicRillsShowAdvanced');
                localStorage.removeItem('magicRillsTextToSpeech');
                
                // Reload the page to apply defaults
                location.reload();
            }
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>