<div class="separator" style="clear: both;"><a href="https://cdn-icons-png.flaticon.com/128/1048/1048953.png" style="display: block; padding: 1em 0px; text-align: center;"><img alt="" border="0" data-original-height="128" data-original-width="128" src="https://cdn-icons-png.flaticon.com/128/1048/1048953.png" style="display: none;" width="200" /></a></div>


<html lang="en">
<head>
    <meta charset="UTF-8"></meta>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"></meta>
    <title>MagicRills - Auto Timetable Generator for Grades 3-5</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --purple: #9c27b0;
            --orange: #ff9800;
            --teal: #009688;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .thumbnail-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .thumbnail-card {
            flex: 1;
            min-width: 250px;
            max-width: 350px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .thumbnail-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.15);
        }
        
        .thumbnail-card:nth-child(2) {
            background: linear-gradient(135deg, var(--purple), #d81b60);
        }
        
        .thumbnail-card:nth-child(3) {
            background: linear-gradient(135deg, var(--teal), #00acc1);
        }
        
        .thumbnail-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .thumbnail-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .thumbnail-desc {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .features {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
            flex-basis: 48%;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-card h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .tab:hover:not(.active) {
            background: #e9e9e9;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .download-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .features {
                flex-direction: column;
            }
            
            .feature-card {
                flex-basis: 100%;
            }
            
            .thumbnail-card {
                min-width: 100%;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 auto;
                text-align: center;
                margin-bottom: 5px;
                font-size: 0.9rem;
                padding: 8px 12px;
            }
            
            .download-options {
                flex-direction: column;
            }
            
            .download-options button {
                width: 100%;
            }
        }
    </style>
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"></link>
</head>
<body>
    <div class="container">
        <header>
            <h1>MagicRills Timetable Generator</h1>
            <p>Advanced open-source auto timetable generator tool for Grade 3rd to 5th</p>
        </header>
        
        <div class="thumbnail-container">
            <div class="thumbnail-card">
                <div class="thumbnail-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3 class="thumbnail-title">Smart Scheduling</h3>
                <p class="thumbnail-desc">Automatically generate optimized timetables with intelligent algorithms</p>
            </div>
            <div class="thumbnail-card">
                <div class="thumbnail-icon">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <h3 class="thumbnail-title">Teacher-Friendly</h3>
                <p class="thumbnail-desc">Manage teacher schedules and free periods with ease</p>
            </div>
            <div class="thumbnail-card">
                <div class="thumbnail-icon">
                    <i class="fas fa-file-export"></i>
                </div>
                <h3 class="thumbnail-title">Easy Export</h3>
                <p class="thumbnail-desc">Download timetables in PDF or DOC format with one click</p>
            </div>
        </div>
        
        <section class="features">
            <div class="feature-card">
                <h3>Master Timetable</h3>
                <p>Generate a comprehensive master timetable for the entire school with all classes and teachers.</p>
            </div>
            <div class="feature-card">
                <h3>Class-wise Timetable</h3>
                <p>Create customized timetables for each individual class from Grade 3 to Grade 5.</p>
            </div>
            <div class="feature-card">
                <h3>Teacher-wise Timetable</h3>
                <p>View and manage schedules for each teacher across different classes and subjects.</p>
            </div>
            <div class="feature-card">
                <h3>Free Period Management</h3>
                <p>Identify and utilize free periods efficiently for better resource allocation.</p>
            </div>
        </section>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'setup')"><i class="fas fa-cog"></i> Setup</div>
            <div class="tab" onclick="openTab(event, 'master')"><i class="fas fa-calendar"></i> Master</div>
            <div class="tab" onclick="openTab(event, 'class')"><i class="fas fa-users"></i> Class-wise</div>
            <div class="tab" onclick="openTab(event, 'teacher')"><i class="fas fa-chalkboard-teacher"></i> Teacher-wise</div>
            <div class="tab" onclick="openTab(event, 'free')"><i class="fas fa-clock"></i> Free Periods</div>
            <div class="tab" onclick="openTab(event, 'subject')"><i class="fas fa-book"></i> Subject-wise</div>
        </div>
        
        <div class="tab-content active" id="setup">
            <h2><i class="fas fa-cog"></i> Initial Setup</h2>
            <p>Configure the basic parameters for your school timetable.</p>
            
            <div class="form-group">
                <label for="schoolName"><i class="fas fa-school"></i> School Name</label>
                <input id="schoolName" placeholder="Enter your school name" type="text" />
            </div>
            
            <div class="form-group">
                <label for="workingDays"><i class="fas fa-calendar-week"></i> Working Days</label>
                <select id="workingDays">
                    <option value="5">5 days (Monday to Friday)</option>
                    <option value="6">6 days (Monday to Saturday)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="periodsPerDay"><i class="fas fa-clock"></i> Periods per Day</label>
                <select id="periodsPerDay">
                    <option value="6">6 periods</option>
                    <option value="7">7 periods</option>
                    <option value="8">8 periods</option>
                    <option value="9">9 periods</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="gradeLevels"><i class="fas fa-graduation-cap"></i> Grade Levels to Include</label>
                <div>
                    <label><input checked="" name="grade" type="checkbox" value="3" /> Grade 3</label>
                    <label><input checked="" name="grade" type="checkbox" value="4" /> Grade 4</label>
                    <label><input checked="" name="grade" type="checkbox" value="5" /> Grade 5</label>
                </div>
            </div>
            
            <button onclick="saveSetup()"><i class="fas fa-save"></i> Save Configuration</button>
            
            <div class="alert" id="setupAlert" style="display: none;"></div>
        </div>
        
        <div class="tab-content" id="master">
            <h2><i class="fas fa-calendar"></i> Master Timetable</h2>
            <p>View and manage the complete master timetable for your school.</p>
            
            <div id="masterTimetableContainer">
                <p>Please complete the setup first to generate the master timetable.</p>
            </div>
            
            <div class="download-options">
                <button class="btn-success" onclick="downloadAsPDF('master')"><i class="fas fa-file-pdf"></i> Download as PDF</button>
                <button class="btn-success" onclick="downloadAsDOC('master')"><i class="fas fa-file-word"></i> Download as DOC</button>
            </div>
        </div>
        
        <div class="tab-content" id="class">
            <h2><i class="fas fa-users"></i> Class-wise Timetable</h2>
            <p>Generate and view timetables for specific classes.</p>
            
            <div class="form-group">
                <label for="selectClass"><i class="fas fa-graduation-cap"></i> Select Class</label>
                <select id="selectClass" onchange="generateClassTimetable()">
                    <option value="">-- Select a Class --</option>
                    <option value="3">Grade 3</option>
                    <option value="4">Grade 4</option>
                    <option value="5">Grade 5</option>
                </select>
            </div>
            
            <div id="classTimetableContainer">
                <p>Please select a class to view its timetable.</p>
            </div>
            
            <div class="download-options">
                <button class="btn-success" onclick="downloadAsPDF('class')"><i class="fas fa-file-pdf"></i> <a href="https://essentialmost.com/be3/V-0.PN3WplvsbFmLVpJuZLDy0/2yNOTfE_2/MQDJAc4TLpTYYP1/MpTrYEw/MADnkv">Download as PDF</a></button>
                <button class="btn-success" onclick="downloadAsDOC('class')"><i class="fas fa-file-word"></i> <a href="https://essentialmost.com/be3/V-0.PN3WplvsbFmLVpJuZLDy0/2yNOTfE_2/MQDJAc4TLpTYYP1/MpTrYEw/MADnkv">Download as DOC</a></button>
            </div>
        </div>
        
        <div class="tab-content" id="teacher">
            <h2><i class="fas fa-chalkboard-teacher"></i> Teacher-wise Timetable</h2>
            <p>View and manage schedules for individual teachers.</p>
            
            <div class="form-group">
                <label for="teacherName"><i class="fas fa-user-tie"></i> Teacher Name</label>
                <input id="teacherName" placeholder="Enter teacher name" type="text" />
            </div>
            
            <div class="form-group">
                <label for="teacherSubjects"><i class="fas fa-book"></i> Subjects Taught</label>
                <input id="teacherSubjects" placeholder="Enter subjects separated by commas" type="text" />
            </div>
            
            <button onclick="addTeacher()"><i class="fas fa-plus"></i> Add Teacher</button>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="selectTeacher"><i class="fas fa-list"></i> Select Teacher</label>
                <select id="selectTeacher" onchange="generateTeacherTimetable()">
                    <option value="">-- Select a Teacher --</option>
                </select>
            </div>
            
            <div id="teacherTimetableContainer">
                <p>Please select a teacher to view their timetable.</p>
            </div>
            
            <div class="download-options">
                <button class="btn-success" onclick="downloadAsPDF('teacher')"><i class="fas fa-file-pdf"></i> Download as PDF</button>
                <button class="btn-success" onclick="downloadAsDOC('teacher')"><i class="fas fa-file-word"></i> Download as DOC</button>
            </div>
        </div>
        
        <div class="tab-content" id="free">
            <h2><i class="fas fa-clock"></i> Free Period Management</h2>
            <p>Identify and utilize free periods efficiently.</p>
            
            <div class="form-group">
                <label for="freePeriodType"><i class="fas fa-filter"></i> View Free Periods By:</label>
                <select id="freePeriodType" onchange="generateFreePeriods()">
                    <option value="teacher">Teacher Free Periods</option>
                    <option value="class">Class Free Periods</option>
                </select>
            </div>
            
            <div id="freePeriodsContainer">
                <p>Please select an option to view free periods.</p>
            </div>
        </div>
        
        <div class="tab-content" id="subject">
            <h2><i class="fas fa-book"></i> Subject-wise Timetable</h2>
            <p>View distribution of subjects across the week.</p>
            
            <div class="form-group">
                <label for="selectSubject"><i class="fas fa-search"></i> Select Subject</label>
                <input id="selectSubject" list="subjectList" placeholder="Enter subject name" type="text" />
                <datalist id="subjectList">
                    <!-- Subjects will be populated dynamically -->
                </datalist>
            </div>
            
            <button onclick="generateSubjectTimetable()"><i class="fas fa-calendar-alt"></i> Generate Timetable</button>
            
            <div id="subjectTimetableContainer">
                <p>Please enter a subject to view its timetable.</p>
            </div>
            
            <div class="download-options">
                <button class="btn-success" onclick="downloadAsPDF('subject')"><i class="fas fa-file-pdf"></i> Download as PDF</button>
                <button class="btn-success" onclick="downloadAsDOC('subject')"><i class="fas fa-file-word"></i> Download as DOC</button>
            </div>
        </div>
        
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Generating timetable...</p>
        </div>
        
        <footer>
            <p>MagicRills Timetable Generator © 2023 | Open-source tool for elementary schools</p>
            <p><i class="fas fa-magic"></i> Making school scheduling magical!</p>
        </footer>
    </div>

    <script>
        // Global variables to store timetable data
        let timetableData = {
            schoolName: "",
            workingDays: 5,
            periodsPerDay: 6,
            grades: [3, 4, 5],
            teachers: [],
            subjects: ["Math", "Science", "English", "Social Studies", "Art", "PE", "Music"],
            classTimetables: {},
            masterTimetable: null
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            populateSubjectList();
        });
        
        // Tab navigation
        function openTab(event, tabId) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Deactivate all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Activate the selected tab
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // If master tab is clicked, generate the master timetable
            if (tabId === 'master' && timetableData.schoolName) {
                generateMasterTimetable();
            }
        }
        
        // Save setup configuration
        function saveSetup() {
            const schoolName = document.getElementById('schoolName').value;
            const workingDays = parseInt(document.getElementById('workingDays').value);
            const periodsPerDay = parseInt(document.getElementById('periodsPerDay').value);
            
            // Get selected grades
            const gradeCheckboxes = document.getElementsByName('grade');
            const selectedGrades = [];
            for (let checkbox of gradeCheckboxes) {
                if (checkbox.checked) {
                    selectedGrades.push(parseInt(checkbox.value));
                }
            }
            
            if (!schoolName) {
                showAlert('setupAlert', 'Please enter your school name', 'danger');
                return;
            }
            
            if (selectedGrades.length === 0) {
                showAlert('setupAlert', 'Please select at least one grade level', 'danger');
                return;
            }
            
            // Save the configuration
            timetableData.schoolName = schoolName;
            timetableData.workingDays = workingDays;
            timetableData.periodsPerDay = periodsPerDay;
            timetableData.grades = selectedGrades;
            
            // Save to localStorage
            localStorage.setItem('timetableData', JSON.stringify(timetableData));
            
            showAlert('setupAlert', 'Configuration saved successfully! You can now generate timetables.', 'success');
            
            // Update the teachers dropdown
            updateTeachersDropdown();
        }
        
        // Load saved data from localStorage
        function loadSavedData() {
            const savedData = localStorage.getItem('timetableData');
            if (savedData) {
                timetableData = JSON.parse(savedData);
                
                // Update the form fields
                document.getElementById('schoolName').value = timetableData.schoolName;
                document.getElementById('workingDays').value = timetableData.workingDays;
                document.getElementById('periodsPerDay').value = timetableData.periodsPerDay;
                
                // Update grade checkboxes
                const gradeCheckboxes = document.getElementsByName('grade');
                for (let checkbox of gradeCheckboxes) {
                    checkbox.checked = timetableData.grades.includes(parseInt(checkbox.value));
                }
                
                // Update teachers dropdown
                updateTeachersDropdown();
            }
        }
        
        // Show alert message
        function showAlert(elementId, message, type) {
            const alertElement = document.getElementById(elementId);
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }
        
        // Generate master timetable
        function generateMasterTimetable() {
            showLoading(true);
            
            setTimeout(() => {
                if (!timetableData.masterTimetable) {
                    timetableData.masterTimetable = generateSampleTimetable('master');
                }
                
                displayTimetable('masterTimetableContainer', timetableData.masterTimetable, 'Master Timetable');
                showLoading(false);
            }, 1000);
        }
        
        // Generate class timetable
        function generateClassTimetable() {
            const selectedClass = document.getElementById('selectClass').value;
            if (!selectedClass) return;
            
            showLoading(true);
            
            setTimeout(() => {
                if (!timetableData.classTimetables[selectedClass]) {
                    timetableData.classTimetables[selectedClass] = generateSampleTimetable('class', selectedClass);
                }
                
                displayTimetable('classTimetableContainer', timetableData.classTimetables[selectedClass], 
                                `Grade ${selectedClass} Timetable`);
                showLoading(false);
            }, 800);
        }
        
        // Generate teacher timetable
        function generateTeacherTimetable() {
            const selectedTeacher = document.getElementById('selectTeacher').value;
            if (!selectedTeacher) return;
            
            showLoading(true);
            
            setTimeout(() => {
                const teacher = timetableData.teachers.find(t => t.name === selectedTeacher);
                if (teacher && !teacher.timetable) {
                    teacher.timetable = generateSampleTimetable('teacher', selectedTeacher);
                }
                
                if (teacher) {
                    displayTimetable('teacherTimetableContainer', teacher.timetable, 
                                    `${teacher.name}'s Timetable (${teacher.subjects})`);
                }
                showLoading(false);
            }, 800);
        }
        
        // Generate free periods
        function generateFreePeriods() {
            const type = document.getElementById('freePeriodType').value;
            showLoading(true);
            
            setTimeout(() => {
                let freePeriodsData;
                if (type === 'teacher') {
                    freePeriodsData = generateSampleFreePeriods('teacher');
                } else {
                    freePeriodsData = generateSampleFreePeriods('class');
                }
                
                displayFreePeriods('freePeriodsContainer', freePeriodsData, type);
                showLoading(false);
            }, 700);
        }
        
        // Generate subject timetable
        function generateSubjectTimetable() {
            const subject = document.getElementById('selectSubject').value;
            if (!subject) {
                showAlert('subjectTimetableContainer', 'Please enter a subject', 'danger');
                return;
            }
            
            showLoading(true);
            
            setTimeout(() => {
                const subjectTimetable = generateSampleTimetable('subject', subject);
                displayTimetable('subjectTimetableContainer', subjectTimetable, 
                                `${subject} Timetable Distribution`);
                
                if (!timetableData.subjects.includes(subject)) {
                    timetableData.subjects.push(subject);
                    populateSubjectList();
                    localStorage.setItem('timetableData', JSON.stringify(timetableData));
                }
                
                showLoading(false);
            }, 900);
        }
        
        // Display timetable in a container
        function displayTimetable(containerId, timetableData, title) {
            const container = document.getElementById(containerId);
            
            if (!timetableData || !timetableData.days || !timetableData.periods) {
                container.innerHTML = '<p>No timetable data available.</p>';
                return;
            }
            
            let html = `<h3><i class="fas fa-calendar-alt"></i> ${title}</h3>`;
            html += '<table><thead><tr><th>Day/Period</th>';
            
            // Add period headers
            for (let i = 1; i <= timetableData.periods; i++) {
                html += `<th>Period ${i}</th>`;
            }
            
            html += '</tr></thead><tbody>';
            
            // Add rows for each day
            timetableData.days.forEach(day => {
                html += `<tr><td>${day.name}</td>`;
                
                for (let i = 1; i <= timetableData.periods; i++) {
                    const period = day.periods.find(p => p.number === i);
                    const cellContent = period ? period.subject : '<span style="color:#888;">Free</span>';
                    html += `<td>${cellContent}</td>`;
                }
                
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        // Display free periods
        function displayFreePeriods(containerId, freePeriodsData, type) {
            const container = document.getElementById(containerId);
            
            if (!freePeriodsData || freePeriodsData.length === 0) {
                container.innerHTML = '<p>No free periods found.</p>';
                return;
            }
            
            let html = `<h3><i class="fas fa-clock"></i> ${type === 'teacher' ? 'Teacher Free Periods' : 'Class Free Periods'}</h3>`;
            html += '<table><thead><tr><th>Name</th><th>Day</th><th>Period</th></tr></thead><tbody>';
            
            freePeriodsData.forEach(item => {
                html += `<tr>
                    <td>${item.name}</td>
                    <td>${item.day}</td>
                    <td>${item.period}</td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        // Add a new teacher
        function addTeacher() {
            const name = document.getElementById('teacherName').value;
            const subjects = document.getElementById('teacherSubjects').value;
            
            if (!name || !subjects) {
                showAlert('teacherTimetableContainer', 'Please enter both teacher name and subjects', 'danger');
                return;
            }
            
            if (timetableData.teachers.some(t => t.name === name)) {
                showAlert('teacherTimetableContainer', 'Teacher already exists', 'danger');
                return;
            }
            
            timetableData.teachers.push({
                name: name,
                subjects: subjects,
                timetable: null
            });
            
            localStorage.setItem('timetableData', JSON.stringify(timetableData));
            updateTeachersDropdown();
            
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSubjects').value = '';
            
            showAlert('teacherTimetableContainer', 'Teacher added successfully', 'success');
        }
        
        // Update teachers dropdown
        function updateTeachersDropdown() {
            const select = document.getElementById('selectTeacher');
            select.innerHTML = '<option value="">-- Select a Teacher --</option>';
            
            timetableData.teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.name;
                option.textContent = teacher.name;
                select.appendChild(option);
            });
        }
        
        // Populate subject list for autocomplete
        function populateSubjectList() {
            const datalist = document.getElementById('subjectList');
            datalist.innerHTML = '';
            
            timetableData.subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                datalist.appendChild(option);
            });
        }
        
        // Show/hide loading indicator
        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }
        
        // Generate sample timetable data
        function generateSampleTimetable(type, identifier) {
            const days = [];
            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            if (timetableData.workingDays === 6) dayNames.push('Saturday');
            
            for (let i = 0; i < timetableData.workingDays; i++) {
                const day = {
                    name: dayNames[i],
                    periods: []
                };
                
                for (let j = 1; j <= timetableData.periodsPerDay; j++) {
                    let subject;
                    
                    if (type === 'master') {
                        subject = `G${3 + (j % 3)}: ${timetableData.subjects[(i + j) % timetableData.subjects.length]}`;
                    } else if (type === 'class') {
                        subject = timetableData.subjects[(i + j) % timetableData.subjects.length];
                    } else if (type === 'teacher') {
                        const teacher = timetableData.teachers.find(t => t.name === identifier);
                        if (teacher) {
                            const subjects = teacher.subjects.split(',').map(s => s.trim());
                            subject = subjects.length > 0 
                                ? `G${3 + (j % 3)}: ${subjects[(i + j) % subjects.length]}`
                                : 'Free';
                        } else {
                            subject = 'Free';
                        }
                    } else if (type === 'subject') {
                        subject = `G${3 + (j % 3)}`;
                    }
                    
                    if (Math.random() > 0.8) {
                        subject = 'Free';
                    }
                    
                    day.periods.push({
                        number: j,
                        subject: subject
                    });
                }
                
                days.push(day);
            }
            
            return {
                days: days,
                periods: timetableData.periodsPerDay
            };
        }
        
        // Generate sample free periods data
        function generateSampleFreePeriods(type) {
            const freePeriods = [];
            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            if (timetableData.workingDays === 6) dayNames.push('Saturday');
            
            if (type === 'teacher') {
                for (let teacher of timetableData.teachers) {
                    for (let i = 0; i < 2; i++) {
                        freePeriods.push({
                            name: teacher.name,
                            day: dayNames[Math.floor(Math.random() * timetableData.workingDays)],
                            period: Math.floor(Math.random() * timetableData.periodsPerDay) + 1
                        });
                    }
                }
            } else {
                for (let grade of timetableData.grades) {
                    for (let i = 0; i < 3; i++) {
                        freePeriods.push({
                            name: `Grade ${grade}`,
                            day: dayNames[Math.floor(Math.random() * timetableData.workingDays)],
                            period: Math.floor(Math.random() * timetableData.periodsPerDay) + 1
                        });
                    }
                }
            }
            
            return freePeriods;
        }
        
        // Download as PDF
        function downloadAsPDF(type) {
            let timetable, title;
            
            switch(type) {
                case 'master':
                    if (!timetableData.masterTimetable) {
                        alert("Please generate the master timetable first");
                        return;
                    }
                    timetable = timetableData.masterTimetable;
                    title = "Master Timetable";
                    break;
                    
                case 'class':
                    const selectedClass = document.getElementById('selectClass').value;
                    if (!selectedClass || !timetableData.classTimetables[selectedClass]) {
                        alert("Please generate a class timetable first");
                        return;
                    }
                    timetable = timetableData.classTimetables[selectedClass];
                    title = `Grade ${selectedClass} Timetable`;
                    break;
                    
                case 'teacher':
                    const selectedTeacher = document.getElementById('selectTeacher').value;
                    const teacher = timetableData.teachers.find(t => t.name === selectedTeacher);
                    if (!selectedTeacher || !teacher || !teacher.timetable) {
                        alert("Please generate a teacher timetable first");
                        return;
                    }
                    timetable = teacher.timetable;
                    title = `${teacher.name}'s Timetable`;
                    break;
                    
                case 'subject':
                    const subject = document.getElementById('selectSubject').value;
                    if (!subject) {
                        alert("Please generate a subject timetable first");
                        return;
                    }
                    timetable = generateSampleTimetable('subject', subject);
                    title = `${subject} Timetable`;
                    break;
                    
                default:
                    return;
            }
            
            showLoading(true);
            
            // Create a canvas to generate the PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(16);
            doc.text(title, 14, 15);
            doc.setFontSize(12);
            doc.text(`School: ${timetableData.schoolName}`, 14, 22);
            
            // Prepare data for the table
            const headers = ['Day/Period'];
            for (let i = 1; i <= timetable.periods; i++) {
                headers.push(`Period ${i}`);
            }
            
            const data = [];
            timetable.days.forEach(day => {
                const row = [day.name];
                day.periods.forEach(period => {
                    row.push(period.subject || 'Free');
                });
                data.push(row);
            });
            
            // Add table
            doc.autoTable({
                head: [headers],
                body: data,
                startY: 30,
                styles: {
                    fontSize: 8,
                    cellPadding: 3,
                    overflow: 'linebreak'
                },
                columnStyles: {
                    0: { cellWidth: 30 }
                }
            });
            
            // Save the PDF
            doc.save(`${title.replace(/ /g, '_')}.pdf`);
            showLoading(false);
        }
        
        // Download as DOC
        function downloadAsDOC(type) {
            let timetable, title;
            
            switch(type) {
                case 'master':
                    if (!timetableData.masterTimetable) {
                        alert("Please generate the master timetable first");
                        return;
                    }
                    timetable = timetableData.masterTimetable;
                    title = "Master Timetable";
                    break;
                    
                case 'class':
                    const selectedClass = document.getElementById('selectClass').value;
                    if (!selectedClass || !timetableData.classTimetables[selectedClass]) {
                        alert("Please generate a class timetable first");
                        return;
                    }
                    timetable = timetableData.classTimetables[selectedClass];
                    title = `Grade ${selectedClass} Timetable`;
                    break;
                    
                case 'teacher':
                    const selectedTeacher = document.getElementById('selectTeacher').value;
                    const teacher = timetableData.teachers.find(t => t.name === selectedTeacher);
                    if (!selectedTeacher || !teacher || !teacher.timetable) {
                        alert("Please generate a teacher timetable first");
                        return;
                    }
                    timetable = teacher.timetable;
                    title = `${teacher.name}'s Timetable`;
                    break;
                    
                case 'subject':
                    const subject = document.getElementById('selectSubject').value;
                    if (!subject) {
                        alert("Please generate a subject timetable first");
                        return;
                    }
                    timetable = generateSampleTimetable('subject', subject);
                    title = `${subject} Timetable`;
                    break;
                    
                default:
                    return;
            }
            
            showLoading(true);
            
            // Create HTML content for the document
            let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #2c3e50; }
                        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                        th { background-color: #4a6fa5; color: white; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <h3>${timetableData.schoolName}</h3>
                    <table>
                        <tr>
                            <th>Day/Period</th>
            `;
            
            // Add period headers
            for (let i = 1; i <= timetable.periods; i++) {
                htmlContent += `<th>Period ${i}</th>`;
            }
            
            htmlContent += `</tr>`;
            
            // Add rows for each day
            timetable.days.forEach(day => {
                htmlContent += `<tr><td>${day.name}</td>`;
                
                day.periods.forEach(period => {
                    htmlContent += `<td>${period.subject || 'Free'}</td>`;
                });
                
                htmlContent += `</tr>`;
            });
            
            htmlContent += `
                        </table>
                    </body>
                    </html>
                `;
            
            // Create Blob and download
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/ /g, '_')}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showLoading(false);
        }
    </script>
    <!-- Load jsPDF from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</body>
</html>